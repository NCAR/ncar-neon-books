
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tutorial 2: Evaluating CLM Simulations at NEON Tower Sites &#8212; NEON Workshop Tutorial Book</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="CTSM Simulations at NEON Tower Sites ‚Äì Tutorial" href="NEON_Simulation_Tutorial.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      <img src="../_static/ncar_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">NEON Workshop Tutorial Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Lesson 1
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../quick_start_docker.html">
   Container and CESM-Lab Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../quick_start_docker_part2.html">
   Getting started with the CESM Lab container
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lesson 2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="NEON_Simulation_Tutorial.html">
   CTSM Simulations at NEON Tower Sites ‚Äì Tutorial
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Lesson 3
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Tutorial 2: Evaluating CLM Simulations at NEON Tower Sites
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/NEON_Visualization_Tutorial.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/NCAR/NEON-visualization"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/NCAR/NEON-visualization/issues/new?title=Issue%20on%20page%20%2Fnotebooks/NEON_Visualization_Tutorial.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/NCAR/NEON-visualization/edit/master/docs/notebooks/NEON_Visualization_Tutorial.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/NCAR/NEON-visualization/master?urlpath=tree/docs/notebooks/NEON_Visualization_Tutorial.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Tutorial 2: Evaluating CLM Simulations at NEON Tower Sites
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-this-tutorial">
     In this tutorial :
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compare-clm-and-neon-latent-heat-flux-data">
   3. Compare CLM and NEON latent heat flux data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#format-data">
     Format Data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#what-is-latent-heat-flux">
     3.1 What is latent heat flux?
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional">
     Optional:
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-latent-heat-flux">
     3.2 Plotting latent heat flux
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#daily-timeseries">
       3.2.1 Daily Timeseries
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#are-the-simulations-and-observations-in-the-plot-similar">
       <strong>
        Are the simulations and observations in the plot similar?
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#questions-to-consider">
       <strong>
        Questions to consider:
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#monthly-averages-component-fluxes-absolute-values">
       3.2.2 Monthly Averages &amp; Component Fluxes: Absolute Values
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#next-create-a-stacked-bar-chart-showing-components-of-simulated-latent-heat-flux-over-different-months">
         Next, create a stacked bar chart showing components of simulated latent heat flux over different months
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       <strong>
        Questions to consider:
       </strong>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#monthly-averages-component-fluxes-proportional-contributions">
       3.2.3 Monthly Averages &amp; Component Fluxes: Proportional Contributions
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#annual-and-seasonal-correlations">
       3.2.4 Annual and Seasonal Correlations
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#average-diel-cycle">
       3.2.5 Average Diel Cycle
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#how-do-transpiration-and-evaporation-components-of-latent-heat-flux-change-throughout-the-day">
       How do transpiration and evaporation components of latent heat flux change throughout the day?
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#congratulations-you-have">
     Congratulations! You have:
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#if-you-would-like-to-learn-more-advanced-interactive-visualization-tools-please-check-back-for-an-advanced-tutorial-that-is-coming-soon">
       If you would like to learn more advanced interactive visualization tools, please check back for an advanced tutorial that is coming soon!
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="tutorial-2-evaluating-clm-simulations-at-neon-tower-sites">
<h1>Tutorial 2: Evaluating CLM Simulations at NEON Tower Sites<a class="headerlink" href="#tutorial-2-evaluating-clm-simulations-at-neon-tower-sites" title="Permalink to this headline">¬∂</a></h1>
<p>This tutorial is an introduction to evaluating CLM at a NEON tower site.  It provides example visualizations and evaluation of simulated latent heat flux using NEON tower observations.</p>
<p><strong>‚ö†Ô∏è Note: Before starting this tutorial, make sure your simulation in Tutorial 1 successfully completed. Please use the same NEON site here.</strong></p>
<hr class="docutils" />
<p><strong>This tutorial uses a Jupyter Notebook.</strong> A Jupyter Notebook is an interactive computing environment that enables the creation and sharing of documents that contain discrete cells of text or documentation and executable code, including plots. It allows users to access, run, and edit the code in a browser. To interact with this notebook:</p>
<ul class="simple">
<li><p>Execute or ‚Äúrun‚Äù cells of executable code (cells denoted with ‚Äò[ ]:‚Äô) using the play button in the menu at the top (see below image)</p></li>
<li><p>The results of running code, such as plots, will appear below that cell</p></li>
<li><p>Each step must be followed in order, otherwise you may encounter errors</p></li>
</ul>
<p><img alt="run cell" src="https://problemsolvingwithpython.com/02-Jupyter-Notebooks/images/run_cell.png" /></p>
<p>For more information on Jupyter notebooks please see the <a class="reference external" href="https://jupyter-notebook-beginner-guide.readthedocs.io/en/latest/what_is_jupyter.html">Jupyter Notebook Quick Start Guide</a>.</p>
<hr class="docutils" />
<div class="section" id="in-this-tutorial">
<h2>In this tutorial :<a class="headerlink" href="#in-this-tutorial" title="Permalink to this headline">¬∂</a></h2>
<p>The tutorial has several components. Below you will find steps to:</p>
<ol class="simple">
<li><p>Explore CLM model data</p></li>
<li><p>Explore NEON observation data</p></li>
<li><p>Compare CLM and NEON latent heat flux data</p></li>
</ol>
<hr class="docutils" />
<h2> 1. Explore CLM model data </h2>
<p>There are countless ways of analyzing and processing model data. This tutorial uses Matplotlib, a comprehensive data visualization and plotting library for Python. For more information on Matplotlib, please see the <a class="reference external" href="https://matplotlib.org/stable/users/index.html">User‚Äôs Guide</a>.</p>
<p>Before diving in, set the NEON site that you simulated in the cell below. <strong>Please use the same site as in the previous tutorial, otherwise the data will not be available.</strong> As a refresher, NEON tower sites include:</p>
<blockquote>
<div><p>ABBY, BART, BLAN, CPER, DCFS, DSNY, GRSM, HARV, JERC, JORN, KONZ, MOAB, NOGP, OAES, ORNL, OSBS, SCBI, SERC, SOAP, SRER, STEI, TALL, TREE, UKFS, UNDE, WOOD.</p>
</div></blockquote>
<p><em>The tutorial is currently set to use the ABBY site. If you ran a simulation for a different tower site, please change the 4-character site name in quotes below to the same as your simulation.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Change the 4-character NEON site below to point to your NEON site:</span>
<span class="n">neon_site</span> <span class="o">=</span> <span class="s2">&quot;ABBY&quot;</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<h3> 1.1 Locate model data </h3>
<p>When the simulation completes, the data are transferred to an <code class="docutils literal notranslate"><span class="pre">archive</span></code> directory. In this directory, there are files that include data for every day of the simulation, as well as files that average model variables monthly. <p></p>
<p><em>Run the cell below to see a subset of the files listed:</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ls ~/archive/<span class="o">{</span>neon_site<span class="o">}</span>.transient/lnd/hist/*2018*.nc <span class="p">|</span>head -20
</pre></div>
</div>
</div>
</div>
<p>Each line of the list above includes the file path (<code class="docutils literal notranslate"><span class="pre">/home/user/archive/{simulation_name}/lnd/hist/</span></code>) and file name. The file names are automatically generated and comprise:</p>
<ul class="simple">
<li><p>the simulation name, which includes:</p>
<ul>
<li><p>the NEON site</p></li>
<li><p>the type of simulation</p>
<ul>
<li><p>The simulation you ran is ‚Äútransient‚Äù. This means the model was initialized and ran for the full length of available data. The initial conditions files for the transient tower simulations were created by cycling over 2018-2019 tower meteorological data.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>the date of simulated data</p></li>
</ul>
<p>The NEON tower simulations generate two types of files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*h0*</span></code>: Variables that are averaged monthly. One file is available for every month of the simulation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*h1*</span></code>: Variables that are recorded every 30 minutes. Values are aggregated into one file for each day of the simulation. Each file includes 48 data points.</p></li>
</ul>
<p><strong>Note:</strong> Only a subset of CLM variables are included on the <code class="docutils literal notranslate"><span class="pre">*h1*</span></code> files, with many more variables included on the monthly-averaged <code class="docutils literal notranslate"><span class="pre">*h0*</span></code> files. A full list of variables that are simulated by CLM is available <a class="reference external" href="https://escomp.github.io/ctsm-docs/versions/master/html/users_guide/setting-up-and-running-a-case/master_list_nofates.html">on this website</a>.</p>
<p><em>Note that you can also find the model data in the ‚ÄòSimulation‚Äô folder on your desktop, which was created as part of this tutorial.</em></p>
<hr class="docutils" />
<p>The files are saved in netcdf format (denoted with the <code class="docutils literal notranslate"><span class="pre">.nc</span></code> file extension), a file format commonly used for storing large, multi-dimensional scientific variables.
Netcdf files are platform independent and self-describing; each file includes metadata that describes the data, including: <strong>variables</strong>, <strong>dimensions</strong>, and <strong>attributes</strong>.</p>
<p>The figure below provides a generic example of the data structure in a netcdf file. The dataset illustrated has two variables (temperature and pressure) that have three dimensions. Coordinate data (e.g., latitude, longitude, time) that describe the data are also included.</p>
<p><em>Note that while each file for NEON tower simulations has multiple variables, the simulation ran for a single site rather than a larger spatial grid and therefore do not include the latitude and longitude dimensions illustrated here. Within each multi-variable file, most of the variables have one dimension (time), while a few soil variables (e.g., moisture, temperature) have two dimensions (time x depth).</em></p>
<p><img alt="Netcdf" src="https://gdfa.ugr.es/python/climate_data/img/xarray2.png" /></p>
<hr class="docutils" />
<h3>1.2 Explore Simulated Data </h3>
<p>This step has several components, which are broken into smaller steps</p>
<h4>1.2.1 Load Python Libraries</h4>
<p><em>Run the below code to import the required python libraries</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Import Libraries</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span><span class="p">,</span> <span class="n">expanduser</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="kn">from</span> <span class="nn">neon_utils</span> <span class="kn">import</span> <span class="n">download_eval_files</span>
</pre></div>
</div>
</div>
</div>
<h4>1.2.2 Select Simulation Year</h4>
<p>For simplicity, we focus on analyzing and evaluating a single year of data. <p></p>
<p>The code below uses data for <strong>2018</strong>, but data are available through this year. You can select a different year by changing the year in the quotes below. <p>
<em>Run the below code to identify the year of interest for making the plots. Note that the same year will be used to download observational data below</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Specify the year below</span>
<span class="n">year</span> <span class="o">=</span> <span class="s2">&quot;2018&quot;</span>
</pre></div>
</div>
</div>
</div>
<h4>1.2.3 Load model data files</h4>
<p>For reading the netCDF files, we are using the <code class="docutils literal notranslate"><span class="pre">xarray</span></code> Python package. You can learn more about <a class="reference external" href="http://xarray.pydata.org/en/stable/">xarray on this website</a>.</p>
<p>The variable <code class="docutils literal notranslate"><span class="pre">sim_path</span></code> points to the location where simulation data are stored.</p>
<p><em>Run the code below to load the model data files. The code will print how many files were loaded</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_path</span> <span class="o">=</span> <span class="s2">&quot;/home/user/archive/&quot;</span><span class="o">+</span><span class="n">neon_site</span><span class="o">+</span><span class="s2">&quot;.transient/lnd/hist/&quot;</span>
<span class="n">sim_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">sim_path</span><span class="p">,</span><span class="n">neon_site</span><span class="o">+</span><span class="s2">&quot;.transient.clm2.h1.&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;*.nc&quot;</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All Simulation files: [&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim_files</span><span class="p">),</span> <span class="s2">&quot;files]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<h4> 1.2.4 Open model data files </h4>
<p>Here we use the python function <code class="docutils literal notranslate"><span class="pre">xarray.open_mfdataset</span></code>, which opens multiple netcdf files as a single xarray dataset. For more information on this xarray function, visit <a class="reference external" href="http://xarray.pydata.org/en/stable/generated/xarray.open_mfdataset.html">the xarray website</a>.</p>
<p><em>Run the below cell to read in the data files. Note that this step might take a few minutes.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">ds_ctsm</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">sim_files</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;by_coords&#39;</span><span class="p">,</span><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading all simulation files took:&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;seconds.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<h4> 1.2.5 Optional Step: Explore dataset from simulations </h4>
<p>This step looks at the dataset that was just created from the simulation data. This step is not required, but will allow you to explore the python dataset and become familiar with the data.</p>
<p><em>Run the below cell to find more information about the data</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ctsm</span>
</pre></div>
</div>
</div>
</div>
<p>In the output, you can click on <code class="docutils literal notranslate"><span class="pre">Dimensions</span></code>, <code class="docutils literal notranslate"><span class="pre">Coordinates</span></code>, <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Variables</span></code>, and <code class="docutils literal notranslate"><span class="pre">Attributes</span></code> to expand and see the details and metadata associated with this dataset.</p>
<p>If you click on <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Variables</span></code>, you will see a list of all the available variables. You can click on the ‚Äònote‚Äô icon at the right end of the line for each variable to see a description of the variable (the <code class="docutils literal notranslate"><span class="pre">long_name</span></code>) and its <code class="docutils literal notranslate"><span class="pre">units</span></code>, as well as other information. Here are a few questions to consider:</p>
<p><strong>Questions to consider</strong></p>
<ol class="simple">
<li><p>What variables are available in the dataset?</p></li>
<li><p>What is the <code class="docutils literal notranslate"><span class="pre">long_name</span></code> and <code class="docutils literal notranslate"><span class="pre">unit</span></code> of the variable <code class="docutils literal notranslate"><span class="pre">FSH</span></code>?</p></li>
<li><p>Can you find the dimensions of this variable?</p></li>
</ol>
<p><strong>üí° Tip</strong>:
Xarray has built-in plotting functions. For quick inspection of a variable, we can use <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> to see it. The code below will make a basic plot of the Gross Primary Production (<code class="docutils literal notranslate"><span class="pre">GPP</span></code>) variable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_ctsm</span><span class="p">[</span><span class="s1">&#39;GPP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<h2> 2. Explore NEON Tower Observation Data </h2>
<h3> 2.1 Download NEON data </h3>
<p><strong>A note about NEON evaluation data</strong>: NEON data for evaluation are pulled from the API and the least restrictive quality control flags are applied. The data are subsequently gap-filled using a redundant data stream regression, while data that are still missing are filled using a Marginal Distribution Sampling (MDS) gap-filling technique. Unit conversions are performed and the data are formatted and supplied as monthly netCDF files.</p>
<p>To download the data, this step uses a preestablished function (<code class="docutils literal notranslate"><span class="pre">download_eval_files</span></code>) to download the NEON observational data files for the site and year specified above. The preprocessed NEON data are available for download from NEON‚Äôs S3 bucket, with the full listing of available data <a class="reference external" href="https://s3.data.neonscience.org/neon-ncar/listing.csv">here</a>.</p>
<blockquote>
<div><p>Note that this downloads the evaluation data based on the year you selected above. If you would like to download all available NEON evaluation data from this site, change the word <code class="docutils literal notranslate"><span class="pre">year</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;all&quot;</span></code> (quotes included) below: <code class="docutils literal notranslate"><span class="pre">download_eval_files(neon_site,</span> <span class="pre">eval_dir,</span> <span class="pre">&quot;all&quot;)</span></code></p>
</div></blockquote>
<p><em>Run the cell below to download available NEON data from the site you selected above.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eval_dir</span> <span class="o">=</span> <span class="s2">&quot;/home/user/evaluation_files/&quot;</span>

<span class="n">download_eval_files</span><span class="p">(</span><span class="n">neon_site</span><span class="p">,</span> <span class="n">eval_dir</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<h3> 2.2 Load NEON data </h3>
<p><em>Run the two cells of code below. The code will print a list of files for the year specified above and read them into a dataset.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eval_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/home/user/evaluation_files/&#39;</span><span class="p">,</span><span class="n">neon_site</span><span class="p">)</span>

<span class="n">eval_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="n">eval_path</span><span class="p">,</span><span class="n">neon_site</span><span class="o">+</span><span class="s2">&quot;_eval_&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;*.nc&quot;</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All Observation files:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">eval_files</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">ds_eval</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">eval_files</span><span class="p">,</span> <span class="n">decode_times</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;by_coords&#39;</span><span class="p">)</span>

<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading all observation files took:&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;s.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="compare-clm-and-neon-latent-heat-flux-data">
<h1>3. Compare CLM and NEON latent heat flux data<a class="headerlink" href="#compare-clm-and-neon-latent-heat-flux-data" title="Permalink to this headline">¬∂</a></h1>
<p>So far, we uploaded files of observational and model data. In this section we will compare observed and simulated <strong>latent heat fluxes</strong>. You can also explore other available variables with this code.</p>
<hr class="docutils" />
<div class="section" id="format-data">
<h2>Format Data<a class="headerlink" href="#format-data" title="Permalink to this headline">¬∂</a></h2>
<p>The next cell of code processes the data into a common format to make analysis easier.
<br/></p>
<p><strong>A note about model timestamps:</strong> The CTSM history includes an initial 0th timestep for each model simulation. This offset in the time dimension can cause challenges when analyzing and evaluating model data if not treated properly. You may notice in the last line of the below cell, we shift the value by -1 to address this issue.</p>
<p><em>Run the below cell of code to extract the variables needed for this notebook and create a single dataframe that includes all the extracted variables</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Convert CTSM data to a Pandas Dataframe for easier handling:</span>
<span class="n">ctsm_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FCEV&#39;</span><span class="p">,</span> <span class="s1">&#39;FCTR&#39;</span><span class="p">,</span> <span class="s1">&#39;FGEV&#39;</span><span class="p">]</span>

<span class="n">df_ctsm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">ds_ctsm</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>

<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ctsm_vars</span><span class="p">:</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span> <span class="p">(</span> <span class="n">ds_ctsm</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>     
    <span class="n">df_ctsm</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">=</span><span class="n">field</span>


<span class="c1">#Convert NEON data to a Pandas Dataframe for easier handling:</span>
<span class="n">eval_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;EFLX_LH_TOT&#39;</span><span class="p">]</span>

<span class="n">df_eval</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="n">ds_eval</span><span class="o">.</span><span class="n">time</span><span class="p">})</span>

<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">eval_vars</span><span class="p">:</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span> <span class="p">(</span> <span class="n">ds_eval</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>     
    <span class="n">df_eval</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">=</span><span class="n">field</span>

<span class="c1">#-- make df_all that includes both obs and sim</span>
<span class="n">df_all</span> <span class="o">=</span> <span class="n">df_eval</span>

<span class="c1">#-- add simulation data to df_all and adjust for offset time dimension:</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ctsm_vars</span><span class="p">:</span>
    <span class="n">sim_var_name</span> <span class="o">=</span> <span class="s2">&quot;sim_&quot;</span><span class="o">+</span><span class="n">var</span>
    <span class="c1">#-- shift simulation data by one</span>
    <span class="n">df_all</span><span class="p">[</span><span class="n">sim_var_name</span><span class="p">]</span><span class="o">=</span><span class="n">df_ctsm</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<p><em>The next cell gives us a quick look at the dataframe to make sure the data are available</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_all</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="what-is-latent-heat-flux">
<h2>3.1 What is latent heat flux?<a class="headerlink" href="#what-is-latent-heat-flux" title="Permalink to this headline">¬∂</a></h2>
<p>Below we explore how well CLM simulates latent heat flux, which is directly observed at NEON towers. Latent heat flux is the energy for water evaporation from the ecosystem. Latent heat flux is a combination of plant transpiration, evaporation from leaf surfaces (e.g., from dew, after precipitation events, etc.), and evaporation from the soil:</p>
<div class="math notranslate nohighlight">
\[ Latent Heat Flux = Transpiration + Canopy Evaporation + Ground Evaporation \]</div>
<p>Although NEON towers cannot distinguish how much each of these processes contributes to latent heat flux, CLM simulations can help us to disentangle the role of each.</p>
<p>First we will calculate latent heat flux simulated by CLM by summing the component fluxes in the above equation. The CLM variables are:</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\(FCEV\)</span>: Canopy evaporation (W m<sup>-2</sup>) <br>
<span class="math notranslate nohighlight">\(FCTR\)</span>: Canopy transpiration (W m<sup>-2</sup>) <br>
<span class="math notranslate nohighlight">\(FGEV\)</span>: Ground evaporation (W m<sup>-2</sup>) <br></p>
</div></blockquote>
<p><em>Run the below cell to calculate simulated latent heat flux</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clm_var</span> <span class="o">=</span> <span class="s1">&#39;sim_EFLX_LH_TOT&#39;</span>

<span class="c1">#EFLX_LH_TOT = FCEV + FCTR +FGEV</span>
<span class="n">df_all</span> <span class="p">[</span><span class="n">clm_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">]</span> \
                 <span class="o">+</span> <span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">]</span>\
                 <span class="o">+</span> <span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">]</span>

<span class="n">df_all</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="optional">
<h2>Optional:<a class="headerlink" href="#optional" title="Permalink to this headline">¬∂</a></h2>
<p>If you are unfamiliar with reading and using the netcdf file format that model and evaluation data are provided, you can save data different formats. The next cell of code will save the pre-processed data in <code class="docutils literal notranslate"><span class="pre">.csv</span></code>, or comma-seperated file format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">csv_dir</span> <span class="o">=</span> <span class="s2">&quot;/home/user/preprocessed_data/&quot;</span>

<span class="c1">#create the directory if it does not exist:</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">csv_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">csv_dir</span><span class="p">)</span>

<span class="n">csv_out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_dir</span><span class="p">,</span> <span class="s2">&quot;preprocessed_&quot;</span><span class="o">+</span><span class="n">neon_site</span><span class="o">+</span><span class="s2">&quot;_&quot;</span><span class="o">+</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot;.csv&quot;</span><span class="p">)</span>
<span class="n">df_all</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_out</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="plotting-latent-heat-flux">
<h2>3.2 Plotting latent heat flux<a class="headerlink" href="#plotting-latent-heat-flux" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="daily-timeseries">
<h3>3.2.1 Daily Timeseries<a class="headerlink" href="#daily-timeseries" title="Permalink to this headline">¬∂</a></h3>
<p>This creates a time-series plot comparing daily average latent heat flux from observations (NEON) and simulations (CLM). To start, we need calculate the daily averages. Run the below cells of code to create the averages and plot.</p>
<p><em>First, we need to extract year, month, day and hour from time column</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#-- extract year, month, day, hour information from time</span>
<span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
</pre></div>
</div>
</div>
</div>
<p><em>Next, calculate daily averages</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_daily</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_daily</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_daily</span><span class="p">[[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;day&quot;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<p>Using the daily averages, we will create a plot using Python‚Äôs <a class="reference external" href="https://matplotlib.org/">matplotlib package</a></p>
<p><em>Run the below cell to create the plot:</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_var</span> <span class="o">=</span> <span class="s1">&#39;EFLX_LH_TOT&#39;</span>
<span class="n">sim_var</span> <span class="o">=</span> <span class="s1">&#39;sim_&#39;</span><span class="o">+</span><span class="n">plot_var</span>

<span class="n">plot_var_desc</span> <span class="o">=</span> <span class="s2">&quot;Latent Heat Flux&quot;</span>
<span class="n">plot_var_unit</span><span class="o">=</span> <span class="s2">&quot;W m$^{-2}$&quot;</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>  <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">df_daily</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">plot_var</span> <span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span><span class="n">ax</span> <span class="o">=</span><span class="n">ax</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;NEON&quot;</span><span class="p">)</span>
<span class="n">df_daily</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;sim_&#39;</span><span class="o">+</span><span class="n">plot_var</span> <span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span><span class="n">ax</span> <span class="o">=</span><span class="n">ax</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;CLM&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">plot_var_desc</span><span class="o">+</span><span class="s2">&quot; [&quot;</span><span class="o">+</span><span class="n">plot_var_unit</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">neon_site</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="are-the-simulations-and-observations-in-the-plot-similar">
<h3><strong>Are the simulations and observations in the plot similar?</strong><a class="headerlink" href="#are-the-simulations-and-observations-in-the-plot-similar" title="Permalink to this headline">¬∂</a></h3>
<p>It is important to also look at variability, as this gives us an indication of when and where simulations are outside the range of observed values.</p>
<p><em>Let‚Äôs explore variability by adding the daily standard deviation as a shaded area to the plot</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_daily_std</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_daily_std</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_daily_std</span><span class="p">[[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;day&quot;</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>  <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">df_daily</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">df_daily</span><span class="p">[</span><span class="n">plot_var</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;NEON&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">df_daily</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">df_daily</span><span class="p">[</span><span class="n">sim_var</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;CLM&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_daily</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">df_daily</span><span class="p">[</span><span class="n">plot_var</span><span class="p">]</span><span class="o">-</span><span class="n">df_daily_std</span><span class="p">[</span><span class="n">plot_var</span><span class="p">],</span> <span class="n">df_daily</span><span class="p">[</span><span class="n">plot_var</span><span class="p">]</span><span class="o">+</span><span class="n">df_daily_std</span><span class="p">[</span><span class="n">plot_var</span><span class="p">]</span> <span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_daily</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">df_daily</span><span class="p">[</span><span class="n">sim_var</span><span class="p">]</span><span class="o">-</span><span class="n">df_daily_std</span><span class="p">[</span><span class="n">sim_var</span><span class="p">],</span> <span class="n">df_daily</span><span class="p">[</span><span class="n">sim_var</span><span class="p">]</span><span class="o">+</span><span class="n">df_daily_std</span><span class="p">[</span><span class="n">sim_var</span><span class="p">]</span> <span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">plot_var_desc</span><span class="o">+</span><span class="s2">&quot; [&quot;</span><span class="o">+</span><span class="n">plot_var_unit</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">neon_site</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The standard deviation allows us to see when CLM underpredicts or overpredicts the NEON tower observations.</p>
</div>
<div class="section" id="questions-to-consider">
<h3><strong>Questions to consider:</strong><a class="headerlink" href="#questions-to-consider" title="Permalink to this headline">¬∂</a></h3>
<ol class="simple">
<li><p>When is the latent heat hlux highest at this site? When is it lowest? <br></p></li>
<li><p>Do fluxes simulated by CLM fall within the range of NEON tower observation variability? <br></p></li>
<li><p>What times of year does CLM shows the best and worst performance in predicting latent heat flux ? <br></p></li>
</ol>
</div>
<hr class="docutils" />
<div class="section" id="monthly-averages-component-fluxes-absolute-values">
<h3>3.2.2 Monthly Averages &amp; Component Fluxes: Absolute Values<a class="headerlink" href="#monthly-averages-component-fluxes-absolute-values" title="Permalink to this headline">¬∂</a></h3>
<p>Next we will disentangle whether transpiration, canopy evaporation, or ground evaporation is the dominant contribution to latent heat flux during each month using CLM data. As mentioned in section 3.1, NEON observations cannot distinguish how much each of these processes contributes to latent heat fluxes.</p>
<p><em>Run the cell below to calculate monthly averages</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_monthly</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_monthly</span><span class="p">[</span><span class="s2">&quot;day&quot;</span><span class="p">]</span><span class="o">=</span><span class="mi">15</span>
<span class="n">df_monthly</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_monthly</span><span class="p">[[</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span><span class="s2">&quot;day&quot;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="next-create-a-stacked-bar-chart-showing-components-of-simulated-latent-heat-flux-over-different-months">
<h4>Next, create a stacked bar chart showing components of simulated latent heat flux over different months<a class="headerlink" href="#next-create-a-stacked-bar-chart-showing-components-of-simulated-latent-heat-flux-over-different-months" title="Permalink to this headline">¬∂</a></h4>
<p><em>Run the cell below to create the plot</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">line_format</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to convert time label to the format of pandas line plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">month_name</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">month</span> <span class="o">==</span> <span class="s1">&#39;Jan&#39;</span><span class="p">:</span>
        <span class="n">month</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{</span><span class="n">label</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="n">month</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>  <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">df_monthly</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;EFLX_LH_TOT&#39;</span> <span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span><span class="n">ax</span> <span class="o">=</span><span class="n">ax</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;NEON Latent Heat Flux&quot;</span><span class="p">,</span><span class="n">use_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df_monthly</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">,</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">,</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">line_format</span><span class="p">,</span> <span class="n">df_monthly</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>

<span class="c1">#set labels for the legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;NEON Latent Heat Flux&quot;</span><span class="p">,</span> <span class="s2">&quot;Canopy Evaporation&quot;</span><span class="p">,</span> <span class="s2">&quot;Canopy Transpiration&quot;</span><span class="p">,</span> <span class="s2">&quot;Ground Evaporation&quot;</span><span class="p">]);</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">plot_var_desc</span><span class="o">+</span><span class="s2">&quot; [&quot;</span><span class="o">+</span><span class="n">plot_var_unit</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
        
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">neon_site</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The monthly averages of NEON latent heat flux observation are plotted as a line on top of the barplot of CLM data for reference.</p>
</div>
</div>
<div class="section" id="id1">
<h3><strong>Questions to consider:</strong><a class="headerlink" href="#id1" title="Permalink to this headline">¬∂</a></h3>
<ol class="simple">
<li><p>Which months does CLM overestimate and underestimate observed latent heat fluxes for this site?</p></li>
<li><p>What times of year is <em>canopy transpiration</em> the largest contributor to the total CLM latent heat flux?</p></li>
<li><p>What times of year are <em>canopy evaporation</em> and <em>ground evaporation</em> important contributors to the total CLM latent heat flux?</p></li>
<li><p>What is the dominant component flux when CLM overestimates observed latent heat fluxes? When CLM underestimates latent heat fluxes?</p></li>
</ol>
</div>
<hr class="docutils" />
<div class="section" id="monthly-averages-component-fluxes-proportional-contributions">
<h3>3.2.3 Monthly Averages &amp; Component Fluxes: Proportional Contributions<a class="headerlink" href="#monthly-averages-component-fluxes-proportional-contributions" title="Permalink to this headline">¬∂</a></h3>
<p>It might be easier to see the proportional contributions of transpiration and evaporation fluxes to total latent heat flux. The code below makes a more advanced plot with two y-axes that helps to illustrate the absolute values of monthly latent heat fluxes and the proportion of component fluxes each month.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#-- calculate the percentage of total latent heat flux</span>
<span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FCEV_perc&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>
<span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FCTR_perc&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>
<span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FGEV_perc&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_monthly</span> <span class="p">[</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>  <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

<span class="n">df_monthly</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;sim_FCEV_perc&#39;</span><span class="p">,</span><span class="s1">&#39;sim_FCTR_perc&#39;</span><span class="p">,</span><span class="s1">&#39;sim_FGEV_perc&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">line_format</span><span class="p">,</span> <span class="n">df_monthly</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;% Components Latent Heat Flux&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;% Canopy Evaporation&quot;</span><span class="p">,</span><span class="s2">&quot;% Canopy Transpiration&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">% G</span><span class="s2">round Evaporation&quot;</span><span class="p">])</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">df_monthly</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;sim_EFLX_LH_TOT&#39;</span> <span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span><span class="n">ax</span> <span class="o">=</span><span class="n">ax2</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;CLM Latent Heat&quot;</span><span class="p">,</span><span class="n">use_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df_monthly</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;EFLX_LH_TOT&#39;</span> <span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span><span class="n">ax</span> <span class="o">=</span><span class="n">ax2</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;NEON Latent Heat&quot;</span><span class="p">,</span><span class="n">use_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">plot_var_desc</span><span class="o">+</span><span class="s2">&quot; [&quot;</span><span class="o">+</span><span class="n">plot_var_unit</span><span class="o">+</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">neon_site</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="annual-and-seasonal-correlations">
<h3>3.2.4 Annual and Seasonal Correlations<a class="headerlink" href="#annual-and-seasonal-correlations" title="Permalink to this headline">¬∂</a></h3>
<p>Scatter plots can help to describe the relationship between latent heat flux and the component transpiration and evaporation fluxes. We can look at these relationships using data from CLM simulations.</p>
<p>First, plot annual average relationships.</p>
<p><em>Run the cells below to first define a generic function that plot scatter diagrams and add a regression line, and then to generate the plots.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Defining generic function for scatter plots</span>
<span class="k">def</span> <span class="nf">detailed_scatter</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">)</span>
    <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">slope</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">intercept</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y=</span><span class="si">{:.2f}</span><span class="s1">x+</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span><span class="n">intercept</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (R2=&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_value</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Generating plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>  <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_daily</span><span class="o">.</span><span class="n">sim_FCEV</span><span class="p">,</span> <span class="n">df_daily</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#1f77b4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Canopy Evaporation [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_daily</span><span class="o">.</span><span class="n">sim_FCTR</span><span class="p">,</span> <span class="n">df_daily</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#ff7f0e&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Canopy Transpiration [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_daily</span><span class="o">.</span><span class="n">sim_FGEV</span><span class="p">,</span> <span class="n">df_daily</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span><span class="s1">&#39;#2ca02c&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Ground Evaporation [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">neon_site</span><span class="o">+</span><span class="s2">&quot; Scatter Plots&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>Since the relationships between latent heat flux and the component transpiration and evaporation fluxes likely vary throughout the year, we can investigate how the relationships change during different seasons.</p>
<p><em>Run the cell below to generate scatter plots by season</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_daily</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_daily</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">%</span><span class="k">12</span>+3)//3).map({1:&#39;DJF&#39;, 2: &#39;MAM&#39;, 3:&#39;JJA&#39;, 4:&#39;SON&#39;})

<span class="n">fig</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>  <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;MAM&#39;</span>
<span class="n">df_season</span> <span class="o">=</span>  <span class="n">df_daily</span><span class="p">[</span><span class="n">df_daily</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">season</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FCEV</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#1f77b4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">season</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Canopy Evaporation [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FCTR</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#ff7f0e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Canopy Transpiration [Wm-2]&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FGEV</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span><span class="s1">&#39;#2ca02c&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Ground Evaporation [Wm-2]&#39;</span><span class="p">)</span>


<span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;JJA&#39;</span>
<span class="n">df_season</span> <span class="o">=</span>  <span class="n">df_daily</span><span class="p">[</span><span class="n">df_daily</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">season</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FCEV</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#1f77b4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">season</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Canopy Evaporation [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FCTR</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#ff7f0e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Canopy Transpiration [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FGEV</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span><span class="s1">&#39;#2ca02c&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Ground Evaporation [Wm-2]&#39;</span><span class="p">)</span>


<span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;SON&#39;</span>
<span class="n">df_season</span> <span class="o">=</span>  <span class="n">df_daily</span><span class="p">[</span><span class="n">df_daily</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">season</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FCEV</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#1f77b4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">season</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Canopy Evaporation [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FCTR</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#ff7f0e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat[Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Canopy Transpiration [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FGEV</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span><span class="s1">&#39;#2ca02c&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Ground Evaporation [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">season</span> <span class="o">=</span> <span class="s1">&#39;DJF&#39;</span>
<span class="n">df_season</span> <span class="o">=</span>  <span class="n">df_daily</span><span class="p">[</span><span class="n">df_daily</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">season</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FCEV</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#1f77b4&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">season</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Canopy Evaporation [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FCTR</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#ff7f0e&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Canopy Transpiration [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="n">detailed_scatter</span> <span class="p">(</span><span class="n">df_season</span><span class="o">.</span><span class="n">sim_FGEV</span><span class="p">,</span> <span class="n">df_season</span><span class="o">.</span><span class="n">sim_EFLX_LH_TOT</span><span class="p">,</span> <span class="s1">&#39;#2ca02c&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat [Wm-2]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Ground Evaporation [Wm-2]&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">year</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">neon_site</span><span class="o">+</span> <span class="s2">&quot; Seasonal Scatter Plots&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="average-diel-cycle">
<h3>3.2.5 Average Diel Cycle<a class="headerlink" href="#average-diel-cycle" title="Permalink to this headline">¬∂</a></h3>
<p>Latent heat flux also changes throughout the day. Does CLM capture the diel cycle that NEON observes? We can compare the average diel cycle from NEON observations and CLM simulations to find out.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">time</span></code> variable in the data is in Greenwich Mean Time (GMT). In the below plots, we adjust for the timezone so that the data are centered on local noon.</p>
<p><em>Run the cell below to convert to local time</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tzone_shift</span> <span class="o">=</span> <span class="n">ds_eval</span><span class="o">.</span><span class="n">TimeDiffUtcLt</span>
<span class="c1">#convert to local time</span>
<span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;local_time&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">tzone_shift</span><span class="p">))</span>

<span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;local_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_all</span><span class="p">[</span><span class="s1">&#39;local_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
</pre></div>
</div>
</div>
</div>
<p><em>Run the cells below to calculate the annual average diel cycle and to generate a plot</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate annual average diel cycle and bias</span>
<span class="n">diel_df_mean</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;local_hour&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">diel_df_std</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;local_hour&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">diel_df_mean</span><span class="p">[</span><span class="s1">&#39;EFLX_LH_TOT_bias&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="s1">&#39;sim_EFLX_LH_TOT&#39;</span><span class="p">]</span><span class="o">-</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="s1">&#39;EFLX_LH_TOT&#39;</span><span class="p">]</span>
<span class="n">diel_df_mean</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot annual average diel cycle and bias</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>  <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  
        
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">diel_df_mean</span><span class="o">.</span><span class="n">local_hour</span><span class="p">,</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="n">plot_var</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;NEON&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">diel_df_mean</span><span class="o">.</span><span class="n">local_hour</span><span class="p">,</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="n">sim_var</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;CLM&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">diel_df_mean</span><span class="o">.</span><span class="n">local_hour</span><span class="p">,</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="n">plot_var</span><span class="p">]</span><span class="o">-</span><span class="n">diel_df_std</span><span class="p">[</span><span class="n">plot_var</span><span class="p">],</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="n">plot_var</span><span class="p">]</span><span class="o">+</span><span class="n">diel_df_std</span><span class="p">[</span><span class="n">plot_var</span><span class="p">]</span> <span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">diel_df_mean</span><span class="o">.</span><span class="n">local_hour</span><span class="p">,</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="n">sim_var</span><span class="p">]</span><span class="o">-</span><span class="n">diel_df_std</span><span class="p">[</span><span class="n">sim_var</span><span class="p">],</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="n">sim_var</span><span class="p">]</span><span class="o">+</span><span class="n">diel_df_std</span><span class="p">[</span><span class="n">sim_var</span><span class="p">]</span> <span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat Flux [Wm-2]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Diurnal Cycle of Latent Heat Flux &quot;</span><span class="o">+</span><span class="n">neon_site</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">year</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>    
<span class="n">diel_df_mean</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="s1">&#39;local_hour&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;EFLX_LH_TOT_bias&#39;</span> <span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span><span class="n">ax</span> <span class="o">=</span><span class="n">ax</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bias&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hour&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Bias&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="how-do-transpiration-and-evaporation-components-of-latent-heat-flux-change-throughout-the-day">
<h3>How do transpiration and evaporation components of latent heat flux change throughout the day?<a class="headerlink" href="#how-do-transpiration-and-evaporation-components-of-latent-heat-flux-change-throughout-the-day" title="Permalink to this headline">¬∂</a></h3>
<p>We can add a panel to the above plot that shows how CLM partitioned latent heat flux to find out.</p>
<p><em>Run the cells below to add a panel to the plot</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Calculating diel cycle flux proportions</span>
<span class="n">diel_df_mean</span><span class="p">[</span><span class="s1">&#39;sim_FCEV_perc&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>
<span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FCTR_perc&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>
<span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FGEV_perc&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">diel_df_mean</span> <span class="p">[</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plotting diel cycl flux proportions</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>

<span class="n">fig</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>  <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span> 

<span class="n">ax0</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
<span class="n">ax0</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">diel_df_mean</span><span class="o">.</span><span class="n">local_hour</span><span class="p">,</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="s1">&#39;EFLX_LH_TOT&#39;</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;NEON&quot;</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">diel_df_mean</span><span class="o">.</span><span class="n">local_hour</span><span class="p">,</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="s1">&#39;sim_EFLX_LH_TOT&#39;</span><span class="p">],</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;CLM&quot;</span><span class="p">)</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">diel_df_mean</span><span class="o">.</span><span class="n">local_hour</span><span class="p">,</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="n">plot_var</span><span class="p">]</span><span class="o">-</span><span class="n">diel_df_std</span><span class="p">[</span><span class="n">plot_var</span><span class="p">],</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="n">plot_var</span><span class="p">]</span><span class="o">+</span><span class="n">diel_df_std</span><span class="p">[</span><span class="n">plot_var</span><span class="p">]</span> <span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">diel_df_mean</span><span class="o">.</span><span class="n">local_hour</span><span class="p">,</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="n">sim_var</span><span class="p">]</span><span class="o">-</span><span class="n">diel_df_std</span><span class="p">[</span><span class="n">sim_var</span><span class="p">],</span> <span class="n">diel_df_mean</span><span class="p">[</span><span class="n">sim_var</span><span class="p">]</span><span class="o">+</span><span class="n">diel_df_std</span><span class="p">[</span><span class="n">sim_var</span><span class="p">]</span> <span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Latent Heat Flux [Wm-2]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Diurnal Cycle of Latent Heat Flux &quot;</span><span class="o">+</span><span class="n">neon_site</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="n">year</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">diel_df_mean</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="s1">&#39;local_hour&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;EFLX_LH_TOT_bias&#39;</span> <span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;o&#39;</span> <span class="p">,</span><span class="n">ax</span> <span class="o">=</span><span class="n">ax1</span> <span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bias&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Bias&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">diel_df_mean</span><span class="p">[[</span><span class="s1">&#39;local_hour&#39;</span><span class="p">,</span><span class="s1">&#39;sim_FCEV&#39;</span><span class="p">,</span><span class="s1">&#39;sim_FCTR&#39;</span><span class="p">,</span><span class="s1">&#39;sim_FGEV&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span> <span class="p">(</span> <span class="n">x</span><span class="o">=</span> <span class="s1">&#39;local_hour&#39;</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%La</span><span class="s1">tent Heat Components&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hour&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="congratulations-you-have">
<h2>Congratulations! You have:<a class="headerlink" href="#congratulations-you-have" title="Permalink to this headline">¬∂</a></h2>
<ol class="simple">
<li><p>Accessed the CTSM model data</p></li>
<li><p>Accessed the NEON observational data</p></li>
<li><p>Evaluated CTSM latent heat fluxes compared to NEON tower observations</p></li>
<li><p>Determined when transpiration and evaporation fluxes drive latent heat fluxes</p></li>
<li><p>Learned how to average over different time periods and create different types of plots</p></li>
</ol>
<div class="section" id="if-you-would-like-to-learn-more-advanced-interactive-visualization-tools-please-check-back-for-an-advanced-tutorial-that-is-coming-soon">
<h3>If you would like to learn more advanced interactive visualization tools, please check back for an advanced tutorial that is coming soon!<a class="headerlink" href="#if-you-would-like-to-learn-more-advanced-interactive-visualization-tools-please-check-back-for-an-advanced-tutorial-that-is-coming-soon" title="Permalink to this headline">¬∂</a></h3>
<p>You can also use this script to explore additional CLM and NEON data by changing the variables in section 3 of this script.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-default-py"
        },
        kernelOptions: {
            kernelName: "conda-env-default-py",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-default-py'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="NEON_Simulation_Tutorial.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">CTSM Simulations at NEON Tower Sites ‚Äì Tutorial</p>
            </div>
        </a>
    </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Negin Sobhani, Danica Lombardozzi, Will Wieder, Gordon Bonan, Dave Lawrence<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>